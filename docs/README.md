# [미션 - 다리 건너기] 명세서

## 목차

1. [기능 목록](#-기능-목록)
2. [상수값 목록](#-상수값-목록)
3. [단위 테스트 목록](#-단위테스트-목록)
4. [클래스 설계](#-클래스-설계)
5. [리팩토링 검토 목록](#-리팩토링-검토-목록)

## 🚀 기능 목록

### 로직 분리에 따른 예외 발생 기준
  - `UI 로직`에서는 도메인 로직을 위한 조건을 모두 검증한 입력값을 받아 전달한다. (잘못된 입력값일 경우, 예외를 발생시킨 뒤 다시 입력값을 받는다.)
  - `도메인 로직`에서는 입력으로 전달받는 값은 모두 검증된 것으로 간주한다. 그러나 개발자의 실수 및 잘못된 메소드 사용에 대해 예외를 발생시킨다.
  - 예외 발생 시 적합한 표준예외를 사용한다.
  - 입력값 오류와 코딩 오류를 구분하기 위해 에러메시지에 `[ERROR] 기능 오류:`, `[ERROR] 입력 오류:`와 같이 표기한다.

### 도메인 로직을 위한 기능

1.
    - [x] 무작위 값을 이용해 주어진 길이의 다리 정보를 생성하는 기능
      - [x] `예외발생` : 주어진 길이가 범위 밖의 수일 경우
      - [x] `예외발생` : bridgeNumber와 일치하는 다리 칸 정보가 없는 경우
2.
    - [x] 주어진 다리 정보를 이용해 건너야 할 다리 칸 정보를 순서대로 꺼낼 수 있게 생성하는 기능
      - [x] `예외발생` : 주어진 다리 정보가 null인 경우
      - [x] `예외발생` : 주어진 다리 정보의 길이가 범위 밖인 경우
      - [x] `예외발생` : 주어진 다리 정보에 지정된 키워드 외의 값이 저장된 경우
3.
    - [x] 현재 사용자가 건너야 할 칸 정보를 꺼낸 뒤 선택한 칸과 비교하여 성공 여부를 반환하는 기능
      - [x] `예외발생` : 더 이상 확인할 다리의 칸이 없는 경우
4.
    - [x] 사용자의 이동 내역에 현재 선택한 칸을 추가하고 상태를 갱신하는 기능
      - 선택한 칸에 대한 3번 기능의 결과에 따라 사용자의 게임 생존 상태를 갱신
      - [x] `예외발생` : 사용자가 이미 다리를 모두 건넜을 경우
      - [x] `예외발생` : 사용자가 이미 다리 건너기를 실패했을 경우
5.
    - [x] 재시도 시 사용자 상태(이동 내역, 생존 여부)를 초기화, 시도 횟수는 증가시키는 기능
6.
    - [x] 사용자의 상태, 남은 칸 수에 따라 게임 진행을 결정하는 기능
7.
    - [x] 입력받은 재시도/종료 결과에 따라 게임을 재시도/종료하는 기능

### UI 로직을 위한 기능

8.
   - [x] 다리의 길이를 입력받는 기능
     - [x] `예외발생` : 입력받은 값이 정수가 아닌 경우
     - [x] `예외발생` : 입력받은 값이 범위 밖의 수인 경우
9. 
    - [x] 사용자가 한 칸 이동에 성공하면 다음 이동할 칸을 입력받는 기능
      - [x] `예외발생` : 입력받은 값이 정해진 키워드 외의 값인 경우
10.
    - [x] 사용자가 실패하면 재시도/종료 여부를 입력받는 기능
      - [x] `예외발생` : 입력받은 값이 정해진 키워드 외의 값인 경우
11.
    - [x] 주어진 이동 현황을 형식에 맞게 출력하는 기능
      - 이미 지난 라운드는 해당하는 칸 위치에 O를 출력, 현재 라운드는 성공 여부에 따라 O/X를 출력
      - 이동 현황 정보에 저장된 키워드 상태에 대해서는 책임지지 않음.
      - [x] `예외발생` : 전달받은 이동 현황이 null인 경우
      - [x] `예외발생` : 전달받은 이동 현황이 비어 있는 경우
12.
    - [x] 게임 결과(게임 성공 여부, 총 시도한 횟수)를 형식에 맞게 출력하는 기능
13.
    - [x] 안내 메시지, 에러 메시지를 형식에 맞게 출력하는 기능
      - [x] `예외발생` : 출력할 메시지가 null인 경우
14.
    - [x] 잘못된 값 입력으로 인한 예외 발생 시, 에러 메시지 출력 후 그 부분부터 다시 입력받는 기능

## 🗄 상수값 목록

### 공통
- [x] 표현 변환기
    - [x] 다리 칸 위치 `1` / `0` -> `U` / `D`

### 도메인 로직 정보
- [x] 다리 최소 길이, 최대 길이
- [x] 건널 수 있는 다리 칸 위치를 나타내는 키워드 `U` / `D`
- [ ] 도메인 로직 오류 메시지

### UI 로직 정보
- [x] 이동할 다리 칸 위치를 결정하는 키워드 `U` / `D` (도메인 로직과 별도)
- [x] 재시도/종료 여부를 결정하는 키워드 `R`/`Q`
- [x] 다리 출력 형식
    - [x] 다리 시작을 나타내는 기호 `[`
    - [x] 다리 칸의 구분을 나타내는 기호 `|` (앞뒤 공백 포함)
    - [x] 다리 끝을 나타내는 기호 `]`
    - [x] 각 칸의 성공 여부를 나타내는 키워드 `O` / `X`
- [ ] 메시지
    - [x] 게임 시작 메시지
    - [x] 입력 요청 메시지
    - [x] 결과 안내 메시지
    - [ ] UI 로직 오류 메시지
- [x] 메시지 형식
    - [x] 오류 메시지 형식 `[ERROR]`
    - [x] 게임 성공 여부
    - [x] 총 시도한 횟수

## ✅ 단위테스트 목록

### 도메인 로직 단위테스트
- [x] 기능1 단위테스트
  - [x] 최소값, 최대값으로 다리 생성 테스트
  - [x] 주어진 길이가 범위 밖의 수이면 예외 발생
  - [x] bridgeNumber와 일치하는 다리 칸 정보가 없는 경우 예외 발생
- [x] 기능2 단위테스트
  - [x] 인자값 예외 테스트
    - [x] 주어진 다리 정보가 null인 경우 예외 발생
    - [x] 주어진 다리 정보의 길이가 범위 밖인 경우 예외 발생
    - [x] 주어진 다리 정보에 `U`, `D` 외의 값이 저장된 경우 예외 발생
- [x] 기능3 단위테스트
  - [x] 현재 선택한 칸의 성공 여부를 확인한 뒤 해당 칸 정보를 삭제
  - [x] 더 이상 확인할 다리의 칸이 없는 경우 예외 발생
- [x] 기능4 단위테스트
  - [x] 이동 결과에 따라 사용자 생존 상태 갱신
  - [x] 객체 상태 예외 테스트
    - [x] 사용자가 이미 다리를 모두 건넜을 경우 예외 발생
    - [x] 사용자가 이미 다리 건너기를 실패했을 경우 예외 발생
- [x] 기능5 단위테스트
  - [x] 재시도 시 사용자 상태 초기화, 시도 횟수 증가

## 🖋 클래스 설계

전체 기능 구현 1차 완료 후 작성 버전임.
![클래스 다이어그램](class-diagram.png)

## ♻️ 리팩토링 검토 목록
### 코드 스타일 및 요구사항
- [ ] 인덴트 2 이하 검토
- [ ] 메소드 분리 검토
- [ ] 메소드 길이 10라인 이하 검토
- [ ] 파라미터 개수 3개 이하 검토
- [ ] 변수, 메소드 선언 순서 정리
- [ ] Java 코드 컨벤션 가이드 준수 검토
- [ ] 요구사항에 주어진 클래스 적용 규칙 검토
- [ ] TODO 주석 모두 해결 후 삭제
- [ ] 클래스, 메소드 주석 작성

### 클래스 분리 및 설계 관련
- [ ] `BridgeGame`에서 직접 `BridgeMaker`를 생성하지 않고, 생성자로 전달받도록 하기
- [ ] 딱 한 번 쓰이는 `ExpressionConverter` 클래스 삭제하고 `BridgeMaker`에서 해당 기능 수행하기
- [ ] `Player`를 이용해서 `MovingMap`을 만들지 말고 `Player`가 현재 상태인 `MovingMap`을 직접 표현하게 하기(직접 map 객체 생성해서 반환)
    - 방법 1. 현재의 MovingMap 생성 로직을 `Player` 내부에서 처리하여 `BridgeGame`에서 이를 반환하는 메소드 수행
    - 방법 2. 현재의 MovingMap 생성 로직을 `Player` 내부에서 처리하고 `toString`으로 해당 정보가 `Player`의 상태로서 출력되도록 함.
      - `BridgeGame`에서는 `Player` 객체 자체를 컨트롤러에 반환하여 필요한 사용자 상태를 모두 전달함.
    - 방법 2는 상태를 한 번에 전달한다는 장점이 있지만, `Player` 객체가 완전히 노출되어 다른 공개 메소드가 오용될 여지가 있음.
    - 따라서 방법 1 및 생성 로직을 단순화시키는 방향으로 리팩토링 진행.
- [ ] 프로젝트에서 전역적으로 쓰이지 않는 `ConsolePrinter`, `ConsoleReader`의 메소드를 인스턴스 메소드로 변경, `View` 객체에서 사용하게 만들기
- [ ] 입력/출력 값 검증 로직 Validator 클래스로 분리하기
- [ ] 입력 값에 대하여 도메인 로직 조건 검증 시 도메인 클래스 참조하는 문제 해결하기
- [ ] `OutputView`의 변환 로직 구현 위치 검토
- [ ] 에러 메시지에 추가한 `입력 오류:`, `기능 오류:` 형식을 출력 위치에 따라 자동으로 적용시키기
- [ ] 에러 메시지 상수 클래스 정의

### 테스트 관련
- [ ] `MovingMap` 생성 로직을 `Player`의 책임으로 변경함에 따라 관련 단위 테스트 작성
  - [ ] `movingHistory`가 비어 있는 경우 예외 발생
- [ ] 생각하지 못한 예외 사항 직접 프로그램 실행해보면서 검토
- [ ] 추가 예외 사항에 대한 단위 테스트, 기능 테스트 작성