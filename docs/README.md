# 개발 기능 목록

## 게임 순서 및 구조

1. 게임 시작

- 게임 시작 문구 출력 : "다리 건너기 게임을 시작합니다."

2. 다리 길이 입력

- 다리 길이 입력 문구 출력 : "다리의 길이를 입력해주세요."
- 다리 길이 입력받기
    - 예외 처리 필요
    - 3부터 20사이의 범위에 속하지 않는 수인 경우
    - 숫자가 아닌 경우

3. 다리 생성

- 입력받은 다리의 길이를 반영

4. 이동 칸 입력

- 이동 입력 문구 출력 : "이동할 칸을 선택해주세요. (위: U, 아래: D)"
- 이동 칸 입력받기
    - 예외 처리 필요
    - U, D가 아닌 모든 경우

5. 다리 이동 결과 출력

- 다리를 건널 수 있을 시 "O" 출력
- 다리를 건널 수 없을 시 "X" 출력
- 다음 순서
    - 다리가 남았고 다리를 건널 수 있을 시 -> 4번
    - 다리를 모두 건넜을 시 -> 6.2)번
    - 다리를 건널 수 없을 시 -> 6.1)번

6.
    1) 게임 재시도 여부 입력

- 재시도 여부 입력 문구 출력 : "게임을 다시 시도할지 여부를 입력해주세요. (재시도: R, 종료: Q)"
- 재시도 여부 입력받기
    - 예외 처리 필요
    - R, Q가 아닌 모든 경우
- 다음 순서
    - 재시도 입력 시 -> 4번
    - 종료 입력 시 -> 6.2)번

6.
    2) 최종 게임 결과 출력

- 결과 문구 출력 : 최종 게임 결과
- 다리 건넌 정보 출력
- 게임 성공 여부 문구 출력 : "게임 성공 여부: "
    - 성공 시 "성공"
    - 실패 시 "실패"
- 총 시도 횟수 출력 : "총 시도한 횟수: %d"

## 생각

### 1. 도메인을 어떻게 나눌 것인가

- **다리**
    - 방향(길)으로 구성된다.
    - 통행자가 맞춰야하는 정답 정보이다.
- **방향**
    - 다리를 구성한다.
    - 사용자에게 입력받는 값으로 다리의 구성요소와 비교된다.
- **통행자**
    - 다리를 건너는 주체이다.
    - 방향과 심판 판정에 대한 정보를 저장한다.
- **기록**
    - 방향과 심판 판정에 대한 정보가 저장되는 곳이다.
- **게임**
    - 게임의 주요 동작을 수행한다.
    - 주요 동작
        - 움직이기 : 통행자가 다리를 건너는 행위
        - 재시도하기 : 사용자가 재시작/종료 여부를 결정하는 행위
- **심판**
    - 판정을 내리는 주체이다.
    - 다리와 통행자의 입력을 비교해 판정을 내린다.
- **판정**
    - 심판에 의해 결정된다.
    - 통행자의 방향이 다리의 방향과 일치하는지 정보가 담긴다.

### 2. 다리를 그리기 위해 통행자의 데이터를 어떻게 다룰 것인가

- 다리를 그리기 위해 필요한 데이터는 다음과 같다.
    - 사용자가 입력한 통행자가 선택한 **방향**
    - 다리와 비교한 방향의 **정답 여부(boolean)**
- Map 자료를 활용하자.
    - 방향이 맞는지 틀렸는지 여부를 Key, 사용자가 입력한 방향을 value로 하는 Map을 활용한다.
    - 입력 순서가 보장되어야 하므로, LinkedHashMap을 사용한다.
    - 방향의 정답 여부가 Key로 모두 구분되어야 하므로, 객체로 포장한다.

### 3. MVC 패턴을 활용하자.

- Model(Domain), View, Controller 로 구성한다.
- Model은 Domain에 관한 코드를 담는다.
- View는 입출력에 관한 코드를 담는다.
- Controller는 Model과 View를 연결한다.

## MVC 패턴과 기능 목록

### Controller

- Domain의 데이터를 View에 전달하는 기능

- View에서 입력된 데이터를 Domain에 전달하는 기능

- 입력 예외 발생 시 재입력 할 수 있는 기능

### View

- 데이터를 입력받는 기능
    1. 다리의 길이를 입력받는 기능
        - 숫자를 제외한 다른 문자가 입력 시 예외
        - 한 글자 미만 혹은 두 글자를 초과하는 문자 입력 시 예외
    2. 움직이는 방향을 입력받는 기능
    3. 재시작 / 종료 여부를 입력받는 기능

- 메시지를 출력하는 기능
    1. 게임 시작 문구를 출력하는 기능
    2. 데이터 입력에 대한 안내 문구를 출력하는 기능
    3. 다리 그래픽을 출력하는 기능
        - 데이터를 받아 다리 그래픽을 만드는 기능
    4. 게임 결과 메시지를 출력하는 기능
    5. 예외 발생 시 예외 메시지를 출력하는 기능

### Domain

#### 다리

- 다리를 생성하는 기능
    - 다리 길이를 입력 받아 해당하는 길이만큼의 다리를 생성
    - 다리는 방향으로 구성

- 다리의 방향을 확인하는 기능
    - 사용자의 방향과 위치를 입력하면, 같은 위치에 두 방향을 비교
    - 사용자가 입력한 위치가 다리의 범위를 벗어나면 예외 처리

- 다리의 끝을 확인하는 기능
    - 사용자의 위치를 입력하면, 다리의 크기와 같은지 비교

#### 방향

- 예외 검증 기능
    - "U", "D"를 제외한 모든 문자 입력 시 예외

- 비교 기능
    - 같은 방향을 가진 두 객체를 비교했을 때 같다는 결과를 반환하는 기능
    - 다른 방향을 가진 두 객체를 비교했을 때 다르다는 결과를 반환하는 기능

#### 명령어

- 예외 검증 기능
    - "R", "Q"를 제외한 모든 문자 입력 시 예외

- 게임 종료 명령어 확인 기능
    - 명령어가 "Q"인지 확인하는 기능

#### 통행자

- 움직이는 기능
  - 다리를 건넌 방향과 판정 기록을 저장

- 현재 위치를 반환하는 기능

- 다리의 시작점으로 돌아가는 기능
    - 통행자가 다리 건너기 게임을 재시작했을 경우 사용

- 기록에 다리의 방향이 틀린 판정이 있는지 확인하는 기능

- MovingRecord 객체를 생성하는 기능
  - View 전달할 객체를 생성

#### 통행기록

- 다리 그래픽을 만들기 위한 스케치를 만드는 기능
  - 다리의 방향(위쪽 다리 혹은 아래쪽 다리)을 입력하면, 해당하는 다리의 판정과 방향을 아래와 같은 기준으로 매핑한 리스트를 반환하는 기능
    - 1 : 정답 방향
    - 0 : 틀린 방향
    - -1 : 무관한 방향

#### 심판

- 다리의 방향과 사용자 입력 방향을 비교해서 판정을 내리는 기능
    - 다리의 방향과 사용자의 입력 방향이 같을 때 : true 판정
    - 다리의 방향과 사용자의 입력 방향이 다를 때 : false 판정

#### 다리 게임 시스템

- 통행자가 움직이도록 하는 기능
    - 심판에게 통행자의 움직임에 대한 판정을 내리게 하는 기능
    - 통행자가 자신의 움직임 방향과 그에 대한 판정을 기록하도록 하는 기능

- 재시도 하는 기능
    - 통행자가 자신의 이전 기록을 지우도록 하는 기능

- 통행자의 시도 횟수를 기록하는 기능

- 게임 성공 여부를 판단하는 기능
    - 통행자가 다리의 끝에 위치했는지 판단하는 기능

## 리팩토링

### 문제 1 : BridgeGame 클래스가 Referee, Bridge 클래스 모두와 관계를 맺고 있다.

- 도메인 클래스의 다이어그램 수정 전
<img width="80%" src="https://user-images.githubusercontent.com/106813090/203343333-42b65940-cc3b-4817-b11a-d4c61f168638.png"/>


- BridgeGame 클래스는 Referee 객체를 참조해 Bridge, Pedestrian 두 객체에 대한 연산을 한다.
- 이 연산을 위해 Referee 클래스는 Bridge 클래스를 다시 한 번 참조하게 된다.
- BridgeGame 클래스가 Referee 객체와 Bridge 객체 중 **하나의 객체만 참조하도록 리팩토링하자.**

### 문제 2 : Pedestrian 클래스와 MovingRecord 클래스가 동일하다.

- Pedestrian 클래스는 다리를 건너는 주체이며, MovingRecord 클래스는 기록을 저장하는 대상이다.
- MovingRecord 클래스를 삭제하거나, 두 클래스 간의 차이를 분명하게 한다.

### 문제 3 : OutputView 에서 Pedestrian 객체를 받는다.

- Pedestrian 객체로 데이터를 형성해 OutputView에서 출력한다.
- 그러나 OutputView는 Pedestrian 객체를 알 필요가 없다. 너무 많은 것을 알고 있다.
- OutputView가 **데이터만 받을 수 있도록 리팩토링하자.**

### 리팩토링 1 : BridgeGame 클래스가 Referee와 관계를 맺을 수 있도록 한다.

- 도메인 클래스의 다이어그램 수정 후
<img width="80%" src="https://user-images.githubusercontent.com/106813090/203343255-000a1ddd-502e-49b7-a163-674f9eab931b.png"/>

- BridgeGame 클래스는 Referee에 의존하고, Referee는 Bridge에 의존할 수 있도록 수정한다.

### 리팩토링 2 & 3 : MovingRecord 클래스가 데이터만 갖는 일급 컬렉션이 되도록 한다.

- MovingRecord의 기능을 모두 Pedestrian에게 넘기고, MovingRecord는 일급 컬렉션으로 수정한다.
- Pedestrian은 멤버변수에 Map을 가져 데이터를 저장할 수 있도록 한다.
- Pedestrian에서 Map 자료를 통해 MovingRecord 객체를 생성할 수 있도록 한다.
- OutputView에서는 MovingRecord 객체를 받아 활용한다.
- MovingRecord는 데이터를 다리로 만들 수 있게 메소드를 제공한다.
